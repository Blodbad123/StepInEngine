<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>C.3 Solaris Zones</title><link rel="stylesheet" href="core.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"/></head><body><div class="sect1" title="C.3 Solaris Zones"><div class="titlepage"><div><div><h1 class="title"><a id="c.3_solaris_zones"/>C.3 Solaris Zones</h1></div></div></div><p>Solaris Zones is a technology used to virtualize operating system services and provide an isolated environment for running applications. A <span class="emphasis"><em>zone</em></span> is a virtualized operating system environment created within a single instance of the Solaris Operating System. When you create a zone, you produce an application execution environment in which processes are isolated from the rest of the system. This isolation should prevent processes that are running in one zone from monitoring or affecting processes that are running in other zones. Even a process running with superuser credentials shouldn’t be able to view or affect activity in other zones.<a id="IDX-APP-C-0114" class="indexterm"/></p><div class="sect2" title="Terminology"><div class="titlepage"><div><div><h2 class="title"><a id="terminology"/>Terminology</h2></div></div></div><p>There are two different kinds of zones: <span class="emphasis"><em>global</em></span> and <span class="emphasis"><em>non-global</em></span>. The global zone represents the conventional Solaris execution environment and is the only zone from which non-global zones can be configured and installed. By default, non-global zones cannot access the global zone or other non-global zones. All zones have a security boundary around them and are confined to their own subtree of the filesystem hierarchy. Every zone has its own root directory, has separate processes and devices, and operates with fewer privileges than the global zone.</p><p>Sun and Oracle were very confident about the security of their Zones technology when they rolled it out:</p><div class="note" title="Note"><h3 class="title">Note</h3><p><span class="emphasis"><em>The platform that I used throughout this section was the default installation of Solaris 10 10/08 x86/x64 DVD Full Image (sol-10-u6-ga1-x86-dvd.iso), which is called Solaris 10 Generic_137138-09</em></span>.</p></div><div class="blockquote"><blockquote class="blockquote"><p>Once a process has been placed in a zone other than the global zone, neither the process nor any of its subsequent children can change zones.</p><p>Network services can be run in a zone. By running network services in a zone, you limit the damage possible in the event of a security violation. An intruder who successfully exploits a security flaw in software running within a zone is confined to the restricted set of actions possible within that zone. The privileges available within a zone are a subset of those available in the system as a whole. . .<sup>[<a href="apcs03.html#ftn.APP-C-FN-13" class="footnoteref">112</a>]</sup></p><p>Processes are restricted to a subset of privileges. Privilege restriction prevents a zone from performing operations that might affect other zones. The set of privileges limits the capabilities of privileged users within the zone. To display the list of privileges available within a zone, use the <code class="literal">ppriv</code> utility.<sup>[<a href="apcs03.html#ftn.APP-C-FN-14" class="footnoteref">113</a>]</sup></p></blockquote></div><p>Solaris Zones is great, but there is one weak point: All zones (global and non-global) share the same kernel. If there is a bug in the kernel that allows arbitrary code execution, it’s possible to cross all security boundaries, escape from a non-global zone, and compromise other non-global zones or even the global zone. To demonstrate this, I recorded a video that shows the exploit for the vulnerability described in <a class="xref" href="ch03.html" title="Chapter 3. Escape from the WWW Zone">Chapter 3</a> in action. The exploit allows an unprivileged user to escape from a non-global zone and then compromise all other zones, including the global zone. You can find the video on this book’s website.<sup>[<a href="apcs03.html#ftn.APP-C-FN-15" class="footnoteref">114</a>]</sup></p></div><div class="sect2" title="Set Up a Non-Global Solaris Zone"><div class="titlepage"><div><div><h2 class="title"><a id="set_up_a_non-global_solaris_zone"/>Set Up a Non-Global Solaris Zone</h2></div></div></div><p>To set up the Solaris Zone for <a class="xref" href="ch03.html" title="Chapter 3. Escape from the WWW Zone">Chapter 3</a>, I did the following steps (all steps have to be performed as a privileged user in the global zone):</p><a id="I_programlisting_d1e12652"/><pre class="programlisting">solaris# <strong class="userinput"><code>id</code></strong>
uid=0(root) gid=0(root)

solaris# <strong class="userinput"><code>zonename</code></strong>
global</pre><p>The first thing I did was to create a filesystem area for the new zone to reside in:</p><a id="I_programlisting_d1e12662"/><pre class="programlisting">solaris# <strong class="userinput"><code>mkdir /wwwzone</code></strong>
solaris# <strong class="userinput"><code>chmod 700 /wwwzone</code></strong>
solaris# <strong class="userinput"><code>ls -l / | grep wwwzone</code></strong>
drwx------   2 root     root         512 Aug 23 12:45 wwwzone</pre><p>I then used <code class="literal">zonecfg</code> to create the new non-global zone:</p><a id="I_programlisting_d1e12678"/><pre class="programlisting">solaris# <strong class="userinput"><code>zonecfg -z wwwzone</code></strong>
wwwzone: No such zone configured
Use 'create' to begin configuring a new zone.
zonecfg:wwwzone&gt; <strong class="userinput"><code>create</code></strong>
zonecfg:wwwzone&gt; <strong class="userinput"><code>set zonepath=/wwwzone</code></strong>
zonecfg:wwwzone&gt; <strong class="userinput"><code>set autoboot=true</code></strong>
zonecfg:wwwzone&gt; <strong class="userinput"><code>add net</code></strong>
zonecfg:wwwzone:net&gt; <strong class="userinput"><code>set address=192.168.10.250</code></strong>
zonecfg:wwwzone:net&gt; <strong class="userinput"><code>set defrouter=192.168.10.1</code></strong>
zonecfg:wwwzone:net&gt; <strong class="userinput"><code>set physical=e1000g0</code></strong>
zonecfg:wwwzone:net&gt; <strong class="userinput"><code>end</code></strong>
zonecfg:wwwzone&gt; <strong class="userinput"><code>verify</code></strong>
zonecfg:wwwzone&gt; <strong class="userinput"><code>commit</code></strong>
zonecfg:wwwzone&gt; <strong class="userinput"><code>exit</code></strong></pre><p>After that, I checked the results of my actions with <code class="literal">zoneadm</code>:</p><a id="I_programlisting_d1e12722"/><pre class="programlisting">solaris# <strong class="userinput"><code>zoneadm list -vc</code></strong>
  ID NAME             STATUS     PATH                           BRAND    IP
   0 global           running    /                              native   shared
   - wwwzone          configured /wwwzone                       native   shared</pre><p>Next, I installed and booted the new non-global zone:</p><a id="I_programlisting_d1e12729"/><pre class="programlisting">solaris# <strong class="userinput"><code>zoneadm -z wwwzone install</code></strong>
Preparing to install zone &lt;wwwzone&gt;.
Creating list of files to copy from the global zone.
Copying &lt;8135&gt; files to the zone.
Initializing zone product registry.
Determining zone package initialization order.
Preparing to initialize &lt;1173&gt; packages on the zone.
Initialized &lt;1173&gt; packages on zone.
Zone &lt;wwwzone&gt; is initialized.

solaris# <strong class="userinput"><code>zoneadm -z wwwzone boot</code></strong></pre><p>To ensure that everything had gone okay, I pinged the IP address of the new non-global zone:</p><a id="I_programlisting_d1e12739"/><pre class="programlisting">solaris# <strong class="userinput"><code>ping 192.168.10.250</code></strong>
192.168.10.250 is alive</pre><p>To log into the new non-global zone, I used the following command:</p><a id="I_programlisting_d1e12746"/><pre class="programlisting">solaris# <strong class="userinput"><code>zlogin -C wwwzone</code></strong></pre><p>After answering the questions regarding language and terminal settings, I logged in as <code class="literal">root</code> and created a new unprivileged user:</p><a id="I_programlisting_d1e12755"/><pre class="programlisting">solaris# <strong class="userinput"><code>id</code></strong>
uid=0(root) gid=0(root)

solaris# <strong class="userinput"><code>zonename</code></strong>
wwwzone

solaris# <strong class="userinput"><code>mkdir /export/home</code></strong>

solaris# <strong class="userinput"><code>mkdir /export/home/wwwuser</code></strong>

solaris# <strong class="userinput"><code>useradd -d /export/home/wwwuser wwwuser</code></strong>

solaris# <strong class="userinput"><code>chown wwwuser /export/home/wwwuser</code></strong>

solaris# <strong class="userinput"><code>passwd wwwuser</code></strong></pre><p>I then used this unprivileged user to exploit the Solaris kernel vulnerability described in <a class="xref" href="ch03.html" title="Chapter 3. Escape from the WWW Zone">Chapter 3</a>.</p></div><div class="sect2" title="Notes"><div class="titlepage"><div><div><h2 class="title"><a id="notes-id10"/>Notes</h2></div></div></div><p><sup>[<a id="APP-C-FN-1" href="#ftn.APP-C-FN-1" class="footnote">100</a>]</sup></p><p><sup>[<a id="APP-C-FN-2" href="#ftn.APP-C-FN-2" class="footnote">101</a>]</sup></p><p><sup>[<a id="APP-C-FN-3" href="#ftn.APP-C-FN-3" class="footnote">102</a>]</sup></p><p><sup>[<a id="APP-C-FN-4" href="#ftn.APP-C-FN-4" class="footnote">103</a>]</sup></p><p><sup>[<a id="APP-C-FN-5" href="#ftn.APP-C-FN-5" class="footnote">104</a>]</sup></p><p><sup>[<a id="APP-C-FN-6" href="#ftn.APP-C-FN-6" class="footnote">105</a>]</sup></p><p><sup>[<a id="APP-C-FN-7" href="#ftn.APP-C-FN-7" class="footnote">106</a>]</sup></p><p><sup>[<a id="APP-C-FN-8" href="#ftn.APP-C-FN-8" class="footnote">107</a>]</sup></p><p><sup>[<a id="APP-C-FN-9" href="#ftn.APP-C-FN-9" class="footnote">108</a>]</sup></p><p><sup>[<a id="APP-C-FN-10" href="#ftn.APP-C-FN-10" class="footnote">109</a>]</sup></p><p><sup>[<a id="APP-C-FN-11" href="#ftn.APP-C-FN-11" class="footnote">110</a>]</sup></p><p><sup>[<a id="APP-C-FN-12" href="#ftn.APP-C-FN-12" class="footnote">111</a>]</sup></p><p><sup>[<a id="APP-C-FN-13" href="#ftn.APP-C-FN-13" class="footnote">112</a>]</sup></p><p><sup>[<a id="APP-C-FN-14" href="#ftn.APP-C-FN-14" class="footnote">113</a>]</sup></p><p><sup>[<a id="APP-C-FN-15" href="#ftn.APP-C-FN-15" class="footnote">114</a>]</sup></p></div><div class="footnotes"><br/><hr/><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-1" href="#APP-C-FN-1" class="para">100</a>] </sup>See Rob King, “New Leopard Security Features—Part I: ASLR,” <span class="emphasis"><em>DVLabs Tipping Point</em></span> (blog), November 7, 2007, <a class="ulink" href="http://dvlabs.tippingpoint.com/blog/2007/11/07/leopard-aslr">http://dvlabs.tippingpoint.com/blog/2007/11/07/leopard-aslr</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-2" href="#APP-C-FN-2" class="para">101</a>] </sup>See Tim Burrell, “GS Cookie Protection—Effectiveness and Limitations,” Microsoft TechNet Blogs: Security Research &amp; Defense (blog), March 16, 2009, <a class="ulink" href="http://blogs.technet.com/srd/archive/2009/03/16/gs-cookie-protection-effectiveness-and-limitations.aspx">http://blogs.technet.com/srd/archive/2009/03/16/gs-cookie-protection-effectiveness-and-limitations.aspx</a>; “Enhanced GS in Visual Studio 2010,” Microsoft TechNet Blogs: Security Research &amp; Defense (blog), March 20, 2009, <a class="ulink" href="http://blogs.technet.com/srd/archive/2009/03/20/enhanced-gs-in-visual-studio-2010.aspx">http://blogs.technet.com/srd/archive/2009/03/20/enhanced-gs-in-visual-studio-2010.aspx</a>; IBM Research “GCC Extension for Protecting Applications from Stack-Smashing Attacks,” last updated August 22, 2005, <a class="ulink" href="http://researchweb.watson.ibm.com/trl/projects/security/ssp/">http://researchweb.watson.ibm.com/trl/projects/security/ssp/</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-3" href="#APP-C-FN-3" class="para">102</a>] </sup>See <a class="ulink" href="http://people.redhat.com/mingo/exec-shield/">http://people.redhat.com/mingo/exec-shield/</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-4" href="#APP-C-FN-4" class="para">103</a>] </sup>See the home page of the PaX team at <a class="ulink" href="http://pax.grsecurity.net/">http://pax.grsecurity.net/</a> as well as the grsecurity website at <a class="ulink" href="http://www.grsecurity.net/">http://www.grsecurity.net/</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-5" href="#APP-C-FN-5" class="para">104</a>] </sup>See Robert Hensing, “Understanding DEP as a Mitigation Technology Part 1,” Microsoft TechNet Blogs: Security Research &amp; Defense (blog), June 12, 2009, <a class="ulink" href="http://blogs.technet.com/srd/archive/2009/06/12/understanding-dep-as-a-mitigation-technology-part-1.aspx">http://blogs.technet.com/srd/archive/2009/06/12/understanding-dep-as-a-mitigation-technology-part-1.aspx</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-6" href="#APP-C-FN-6" class="para">105</a>] </sup>See <a class="ulink" href="http://technet.microsoft.com/en-en/sysinternals/bb896653/">http://technet.microsoft.com/en-en/sysinternals/bb896653/</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-7" href="#APP-C-FN-7" class="para">106</a>] </sup>For more information, see the Secunia study by Alin Rad Pop, “DEP/ASLR Implementation Progress in Popular Third-party Windows Applications,” 2010, <a class="ulink" href="http://secunia.com/gfx/pdf/DEP_ASLR_2010_paper.pdf">http://secunia.com/gfx/pdf/DEP_ASLR_2010_paper.pdf</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-8" href="#APP-C-FN-8" class="para">107</a>] </sup>To download BinScope Binary Analyzer, visit <a class="ulink" href="http://go.microsoft.com/?linkid=9678113">http://go.microsoft.com/?linkid=9678113</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-9" href="#APP-C-FN-9" class="para">108</a>] </sup>See <a class="ulink" href="http://www.trapkit.de/tools/checksec.html">http://www.trapkit.de/tools/checksec.html</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-10" href="#APP-C-FN-10" class="para">109</a>] </sup>See TIS Committee, <span class="emphasis"><em>Tool Interface Standard (TIS) Executable and Linking Format (ELF) Specification</em></span>, version 1.2, 1995, <a class="ulink" href="http://refspecs.freestandards.org/elf/elf.pdf">http://refspecs.freestandards.org/elf/elf.pdf</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-11" href="#APP-C-FN-11" class="para">110</a>] </sup>See note 9 above.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-12" href="#APP-C-FN-12" class="para">111</a>] </sup>See Chris Rohlf, “Self Protecting Global Offset Table (GOT),” draft version 1.4, August 2008, <a class="ulink" href="http://code.google.com/p/em386/downloads/detail?name=Self-Protecting-GOT.html">http://code.google.com/p/em386/downloads/detail?name=Self-Protecting-GOT.html</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-13" href="#APP-C-FN-13" class="para">112</a>] </sup>See “Introduction to Solaris Zones: Features Provided by Non-Global Zones,” <span class="emphasis"><em>System Administration Guide: Oracle Solaris Containers—Resource Management and Oracle Solaris Zones</em></span>, 2010, <a class="ulink" href="http://download.oracle.com/docs/cd/E19455-01/817-1592/zones.intro-9/index.html">http://download.oracle.com/docs/cd/E19455-01/817-1592/zones.intro-9/index.html</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-14" href="#APP-C-FN-14" class="para">113</a>] </sup>See “Solaris Zones Administration (Overview): Privileges in a Non-Global Zone,” <span class="emphasis"><em>System Administration Guide:Virtualization Using the Solaris Operating System</em></span>, 2010, <a class="ulink" href="http://download.oracle.com/docs/cd/E19082-01/819-2450/z.admin.ov-18/index.html">http://download.oracle.com/docs/cd/E19082-01/819-2450/z.admin.ov-18/index.html</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-15" href="#APP-C-FN-15" class="para">114</a>] </sup>See <a class="ulink" href="http://www.trapkit.de/books/bhd/">http://www.trapkit.de/books/bhd/</a>.</p></div></div></div></body></html>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>C.3 Solaris Zones</title><link rel="stylesheet" href="core.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"/></head><body><div class="sect1" title="C.3 Solaris Zones"><div class="titlepage"><div><div><h1 class="title"><a id="c.3_solaris_zones"/>C.3 Solaris Zones</h1></div></div></div><p>Solaris Zones is a technology used to virtualize operating system services and provide an isolated environment for running applications. A <span class="emphasis"><em>zone</em></span> is a virtualized operating system environment created within a single instance of the Solaris Operating System. When you create a zone, you produce an application execution environment in which processes are isolated from the rest of the system. This isolation should prevent processes that are running in one zone from monitoring or affecting processes that are running in other zones. Even a process running with superuser credentials shouldn’t be able to view or affect activity in other zones.<a id="IDX-APP-C-0114" class="indexterm"/></p><div class="sect2" title="Terminology"><div class="titlepage"><div><div><h2 class="title"><a id="terminology"/>Terminology</h2></div></div></div><p>There are two different kinds of zones: <span class="emphasis"><em>global</em></span> and <span class="emphasis"><em>non-global</em></span>. The global zone represents the conventional Solaris execution environment and is the only zone from which non-global zones can be configured and installed. By default, non-global zones cannot access the global zone or other non-global zones. All zones have a security boundary around them and are confined to their own subtree of the filesystem hierarchy. Every zone has its own root directory, has separate processes and devices, and operates with fewer privileges than the global zone.</p><p>Sun and Oracle were very confident about the security of their Zones technology when they rolled it out:</p><div class="note" title="Note"><h3 class="title">Note</h3><p><span class="emphasis"><em>The platform that I used throughout this section was the default installation of Solaris 10 10/08 x86/x64 DVD Full Image (sol-10-u6-ga1-x86-dvd.iso), which is called Solaris 10 Generic_137138-09</em></span>.</p></div><div class="blockquote"><blockquote class="blockquote"><p>Once a process has been placed in a zone other than the global zone, neither the process nor any of its subsequent children can change zones.</p><p>Network services can be run in a zone. By running network services in a zone, you limit the damage possible in the event of a security violation. An intruder who successfully exploits a security flaw in software running within a zone is confined to the restricted set of actions possible within that zone. The privileges available within a zone are a subset of those available in the system as a whole. . .<sup>[<a href="apcs03.html#ftn.APP-C-FN-13" class="footnoteref">112</a>]</sup></p><p>Processes are restricted to a subset of privileges. Privilege restriction prevents a zone from performing operations that might affect other zones. The set of privileges limits the capabilities of privileged users within the zone. To display the list of privileges available within a zone, use the <code class="literal">ppriv</code> utility.<sup>[<a href="apcs03.html#ftn.APP-C-FN-14" class="footnoteref">113</a>]</sup></p></blockquote></div><p>Solaris Zones is great, but there is one weak point: All zones (global and non-global) share the same kernel. If there is a bug in the kernel that allows arbitrary code execution, it’s possible to cross all security boundaries, escape from a non-global zone, and compromise other non-global zones or even the global zone. To demonstrate this, I recorded a video that shows the exploit for the vulnerability described in <a class="xref" href="ch03.html" title="Chapter 3. Escape from the WWW Zone">Chapter 3</a> in action. The exploit allows an unprivileged user to escape from a non-global zone and then compromise all other zones, including the global zone. You can find the video on this book’s website.<sup>[<a href="apcs03.html#ftn.APP-C-FN-15" class="footnoteref">114</a>]</sup></p></div><div class="sect2" title="Set Up a Non-Global Solaris Zone"><div class="titlepage"><div><div><h2 class="title"><a id="set_up_a_non-global_solaris_zone"/>Set Up a Non-Global Solaris Zone</h2></div></div></div><p>To set up the Solaris Zone for <a class="xref" href="ch03.html" title="Chapter 3. Escape from the WWW Zone">Chapter 3</a>, I did the following steps (all steps have to be performed as a privileged user in the global zone):</p><a id="I_programlisting_d1e12652"/><pre class="programlisting">solaris# <strong class="userinput"><code>id</code></strong>
uid=0(root) gid=0(root)

solaris# <strong class="userinput"><code>zonename</code></strong>
global</pre><p>The first thing I did was to create a filesystem area for the new zone to reside in:</p><a id="I_programlisting_d1e12662"/><pre class="programlisting">solaris# <strong class="userinput"><code>mkdir /wwwzone</code></strong>
solaris# <strong class="userinput"><code>chmod 700 /wwwzone</code></strong>
solaris# <strong class="userinput"><code>ls -l / | grep wwwzone</code></strong>
drwx------   2 root     root         512 Aug 23 12:45 wwwzone</pre><p>I then used <code class="literal">zonecfg</code> to create the new non-global zone:</p><a id="I_programlisting_d1e12678"/><pre class="programlisting">solaris# <strong class="userinput"><code>zonecfg -z wwwzone</code></strong>
wwwzone: No such zone configured
Use 'create' to begin configuring a new zone.
zonecfg:wwwzone&gt; <strong class="userinput"><code>create</code></strong>
zonecfg:wwwzone&gt; <strong class="userinput"><code>set zonepath=/wwwzone</code></strong>
zonecfg:wwwzone&gt; <strong class="userinput"><code>set autoboot=true</code></strong>
zonecfg:wwwzone&gt; <strong class="userinput"><code>add net</code></strong>
zonecfg:wwwzone:net&gt; <strong class="userinput"><code>set address=192.168.10.250</code></strong>
zonecfg:wwwzone:net&gt; <strong class="userinput"><code>set defrouter=192.168.10.1</code></strong>
zonecfg:wwwzone:net&gt; <strong class="userinput"><code>set physical=e1000g0</code></strong>
zonecfg:wwwzone:net&gt; <strong class="userinput"><code>end</code></strong>
zonecfg:wwwzone&gt; <strong class="userinput"><code>verify</code></strong>
zonecfg:wwwzone&gt; <strong class="userinput"><code>commit</code></strong>
zonecfg:wwwzone&gt; <strong class="userinput"><code>exit</code></strong></pre><p>After that, I checked the results of my actions with <code class="literal">zoneadm</code>:</p><a id="I_programlisting_d1e12722"/><pre class="programlisting">solaris# <strong class="userinput"><code>zoneadm list -vc</code></strong>
  ID NAME             STATUS     PATH                           BRAND    IP
   0 global           running    /                              native   shared
   - wwwzone          configured /wwwzone                       native   shared</pre><p>Next, I installed and booted the new non-global zone:</p><a id="I_programlisting_d1e12729"/><pre class="programlisting">solaris# <strong class="userinput"><code>zoneadm -z wwwzone install</code></strong>
Preparing to install zone &lt;wwwzone&gt;.
Creating list of files to copy from the global zone.
Copying &lt;8135&gt; files to the zone.
Initializing zone product registry.
Determining zone package initialization order.
Preparing to initialize &lt;1173&gt; packages on the zone.
Initialized &lt;1173&gt; packages on zone.
Zone &lt;wwwzone&gt; is initialized.

solaris# <strong class="userinput"><code>zoneadm -z wwwzone boot</code></strong></pre><p>To ensure that everything had gone okay, I pinged the IP address of the new non-global zone:</p><a id="I_programlisting_d1e12739"/><pre class="programlisting">solaris# <strong class="userinput"><code>ping 192.168.10.250</code></strong>
192.168.10.250 is alive</pre><p>To log into the new non-global zone, I used the following command:</p><a id="I_programlisting_d1e12746"/><pre class="programlisting">solaris# <strong class="userinput"><code>zlogin -C wwwzone</code></strong></pre><p>After answering the questions regarding language and terminal settings, I logged in as <code class="literal">root</code> and created a new unprivileged user:</p><a id="I_programlisting_d1e12755"/><pre class="programlisting">solaris# <strong class="userinput"><code>id</code></strong>
uid=0(root) gid=0(root)

solaris# <strong class="userinput"><code>zonename</code></strong>
wwwzone

solaris# <strong class="userinput"><code>mkdir /export/home</code></strong>

solaris# <strong class="userinput"><code>mkdir /export/home/wwwuser</code></strong>

solaris# <strong class="userinput"><code>useradd -d /export/home/wwwuser wwwuser</code></strong>

solaris# <strong class="userinput"><code>chown wwwuser /export/home/wwwuser</code></strong>

solaris# <strong class="userinput"><code>passwd wwwuser</code></strong></pre><p>I then used this unprivileged user to exploit the Solaris kernel vulnerability described in <a class="xref" href="ch03.html" title="Chapter 3. Escape from the WWW Zone">Chapter 3</a>.</p></div><div class="sect2" title="Notes"><div class="titlepage"><div><div><h2 class="title"><a id="notes-id10"/>Notes</h2></div></div></div><p><sup>[<a id="APP-C-FN-1" href="#ftn.APP-C-FN-1" class="footnote">100</a>]</sup></p><p><sup>[<a id="APP-C-FN-2" href="#ftn.APP-C-FN-2" class="footnote">101</a>]</sup></p><p><sup>[<a id="APP-C-FN-3" href="#ftn.APP-C-FN-3" class="footnote">102</a>]</sup></p><p><sup>[<a id="APP-C-FN-4" href="#ftn.APP-C-FN-4" class="footnote">103</a>]</sup></p><p><sup>[<a id="APP-C-FN-5" href="#ftn.APP-C-FN-5" class="footnote">104</a>]</sup></p><p><sup>[<a id="APP-C-FN-6" href="#ftn.APP-C-FN-6" class="footnote">105</a>]</sup></p><p><sup>[<a id="APP-C-FN-7" href="#ftn.APP-C-FN-7" class="footnote">106</a>]</sup></p><p><sup>[<a id="APP-C-FN-8" href="#ftn.APP-C-FN-8" class="footnote">107</a>]</sup></p><p><sup>[<a id="APP-C-FN-9" href="#ftn.APP-C-FN-9" class="footnote">108</a>]</sup></p><p><sup>[<a id="APP-C-FN-10" href="#ftn.APP-C-FN-10" class="footnote">109</a>]</sup></p><p><sup>[<a id="APP-C-FN-11" href="#ftn.APP-C-FN-11" class="footnote">110</a>]</sup></p><p><sup>[<a id="APP-C-FN-12" href="#ftn.APP-C-FN-12" class="footnote">111</a>]</sup></p><p><sup>[<a id="APP-C-FN-13" href="#ftn.APP-C-FN-13" class="footnote">112</a>]</sup></p><p><sup>[<a id="APP-C-FN-14" href="#ftn.APP-C-FN-14" class="footnote">113</a>]</sup></p><p><sup>[<a id="APP-C-FN-15" href="#ftn.APP-C-FN-15" class="footnote">114</a>]</sup></p></div><div class="footnotes"><br/><hr/><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-1" href="#APP-C-FN-1" class="para">100</a>] </sup>See Rob King, “New Leopard Security Features—Part I: ASLR,” <span class="emphasis"><em>DVLabs Tipping Point</em></span> (blog), November 7, 2007, <a class="ulink" href="http://dvlabs.tippingpoint.com/blog/2007/11/07/leopard-aslr">http://dvlabs.tippingpoint.com/blog/2007/11/07/leopard-aslr</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-2" href="#APP-C-FN-2" class="para">101</a>] </sup>See Tim Burrell, “GS Cookie Protection—Effectiveness and Limitations,” Microsoft TechNet Blogs: Security Research &amp; Defense (blog), March 16, 2009, <a class="ulink" href="http://blogs.technet.com/srd/archive/2009/03/16/gs-cookie-protection-effectiveness-and-limitations.aspx">http://blogs.technet.com/srd/archive/2009/03/16/gs-cookie-protection-effectiveness-and-limitations.aspx</a>; “Enhanced GS in Visual Studio 2010,” Microsoft TechNet Blogs: Security Research &amp; Defense (blog), March 20, 2009, <a class="ulink" href="http://blogs.technet.com/srd/archive/2009/03/20/enhanced-gs-in-visual-studio-2010.aspx">http://blogs.technet.com/srd/archive/2009/03/20/enhanced-gs-in-visual-studio-2010.aspx</a>; IBM Research “GCC Extension for Protecting Applications from Stack-Smashing Attacks,” last updated August 22, 2005, <a class="ulink" href="http://researchweb.watson.ibm.com/trl/projects/security/ssp/">http://researchweb.watson.ibm.com/trl/projects/security/ssp/</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-3" href="#APP-C-FN-3" class="para">102</a>] </sup>See <a class="ulink" href="http://people.redhat.com/mingo/exec-shield/">http://people.redhat.com/mingo/exec-shield/</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-4" href="#APP-C-FN-4" class="para">103</a>] </sup>See the home page of the PaX team at <a class="ulink" href="http://pax.grsecurity.net/">http://pax.grsecurity.net/</a> as well as the grsecurity website at <a class="ulink" href="http://www.grsecurity.net/">http://www.grsecurity.net/</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-5" href="#APP-C-FN-5" class="para">104</a>] </sup>See Robert Hensing, “Understanding DEP as a Mitigation Technology Part 1,” Microsoft TechNet Blogs: Security Research &amp; Defense (blog), June 12, 2009, <a class="ulink" href="http://blogs.technet.com/srd/archive/2009/06/12/understanding-dep-as-a-mitigation-technology-part-1.aspx">http://blogs.technet.com/srd/archive/2009/06/12/understanding-dep-as-a-mitigation-technology-part-1.aspx</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-6" href="#APP-C-FN-6" class="para">105</a>] </sup>See <a class="ulink" href="http://technet.microsoft.com/en-en/sysinternals/bb896653/">http://technet.microsoft.com/en-en/sysinternals/bb896653/</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-7" href="#APP-C-FN-7" class="para">106</a>] </sup>For more information, see the Secunia study by Alin Rad Pop, “DEP/ASLR Implementation Progress in Popular Third-party Windows Applications,” 2010, <a class="ulink" href="http://secunia.com/gfx/pdf/DEP_ASLR_2010_paper.pdf">http://secunia.com/gfx/pdf/DEP_ASLR_2010_paper.pdf</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-8" href="#APP-C-FN-8" class="para">107</a>] </sup>To download BinScope Binary Analyzer, visit <a class="ulink" href="http://go.microsoft.com/?linkid=9678113">http://go.microsoft.com/?linkid=9678113</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-9" href="#APP-C-FN-9" class="para">108</a>] </sup>See <a class="ulink" href="http://www.trapkit.de/tools/checksec.html">http://www.trapkit.de/tools/checksec.html</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-10" href="#APP-C-FN-10" class="para">109</a>] </sup>See TIS Committee, <span class="emphasis"><em>Tool Interface Standard (TIS) Executable and Linking Format (ELF) Specification</em></span>, version 1.2, 1995, <a class="ulink" href="http://refspecs.freestandards.org/elf/elf.pdf">http://refspecs.freestandards.org/elf/elf.pdf</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-11" href="#APP-C-FN-11" class="para">110</a>] </sup>See note 9 above.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-12" href="#APP-C-FN-12" class="para">111</a>] </sup>See Chris Rohlf, “Self Protecting Global Offset Table (GOT),” draft version 1.4, August 2008, <a class="ulink" href="http://code.google.com/p/em386/downloads/detail?name=Self-Protecting-GOT.html">http://code.google.com/p/em386/downloads/detail?name=Self-Protecting-GOT.html</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-13" href="#APP-C-FN-13" class="para">112</a>] </sup>See “Introduction to Solaris Zones: Features Provided by Non-Global Zones,” <span class="emphasis"><em>System Administration Guide: Oracle Solaris Containers—Resource Management and Oracle Solaris Zones</em></span>, 2010, <a class="ulink" href="http://download.oracle.com/docs/cd/E19455-01/817-1592/zones.intro-9/index.html">http://download.oracle.com/docs/cd/E19455-01/817-1592/zones.intro-9/index.html</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-14" href="#APP-C-FN-14" class="para">113</a>] </sup>See “Solaris Zones Administration (Overview): Privileges in a Non-Global Zone,” <span class="emphasis"><em>System Administration Guide:Virtualization Using the Solaris Operating System</em></span>, 2010, <a class="ulink" href="http://download.oracle.com/docs/cd/E19082-01/819-2450/z.admin.ov-18/index.html">http://download.oracle.com/docs/cd/E19082-01/819-2450/z.admin.ov-18/index.html</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-C-FN-15" href="#APP-C-FN-15" class="para">114</a>] </sup>See <a class="ulink" href="http://www.trapkit.de/books/bhd/">http://www.trapkit.de/books/bhd/</a>.</p></div></div></div></body></html>
